
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorador Interactivo de Vehículos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Visualization & Content Choices: 
        - Car Data: Stored as JS array of objects.
        - Filters: HTML dropdowns and range input, JS event listeners for dynamic filtering. Goal: Allow users to narrow down listings. Interaction: Updates listings and charts.
        - Listings: HTML cards generated by JS. Goal: Display detailed car info. Interaction: N/A for v1.
        - Price Distribution Chart (Bar, Chart.js): Shows count of cars in price brackets. Goal: Understand price spread. Interaction: Updates with filters.
        - Cars by Brand Chart (Pie, Chart.js): Shows proportion of listings per brand. Goal: Brand availability. Interaction: Updates with filters.
        - Cars by Year Chart (Bar, Chart.js): Shows count of cars per year. Goal: Age distribution. Interaction: Updates with filters.
        - Cars by Location Chart (Pie, Chart.js): Shows count of cars per location. Goal: Geographical distribution. Interaction: Updates with filters.
        All charts will use Chart.js (Canvas) and be dynamically updated. NO SVG/Mermaid. -->
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Using Inter as a default modern font */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Default max-width, can be adjusted by Tailwind classes per chart */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px; /* Max height */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .chart-container {
                height: 350px;
            }
        }
        /* Custom scrollbar for better aesthetics if needed */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* Tailwind's slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* Tailwind's slate-500 */
        }
        .filter-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151; /* Tailwind's gray-700 */
        }
        .filter-select, .filter-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; /* Tailwind's gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #3b82f6; /* Tailwind's blue-500 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .listing-card {
            background-color: #ffffff; /* bg-white */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .listing-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <header class="bg-sky-700 text-white p-6 shadow-md">
        <div class="container mx-auto max-w-7xl">
            <h1 class="text-3xl font-bold">Explorador Interactivo de Vehículos en Uruguay</h1>
        </div>
    </header>

    <main class="container mx-auto max-w-7xl p-4 md:p-6">
        
        <section id="filters" class="mb-8 p-6 bg-white rounded-lg shadow-lg">
            <h2 class="text-2xl font-semibold mb-6 text-sky-700">Filtrar Vehículos</h2>
            <p class="mb-6 text-stone-600">Utilice los filtros a continuación para refinar su búsqueda de vehículos. Los listados y gráficos se actualizarán automáticamente.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <label for="brandFilter" class="filter-label">Marca:</label>
                    <select id="brandFilter" class="filter-select">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div>
                    <label for="yearFilter" class="filter-label">Año:</label>
                    <select id="yearFilter" class="filter-select">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div>
                    <label for="locationFilter" class="filter-label">Ubicación:</label>
                    <select id="locationFilter" class="filter-select">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div>
                    <label for="priceRangeFilter" class="filter-label">Rango de Precio (USD): <span id="priceValue"></span></label>
                    <input type="range" id="priceRangeFilter" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-sky-600" min="0" max="100000" step="1000">
                </div>
            </div>
            <div class="mt-6 text-right">
                <button id="clearFiltersButton" class="px-6 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition duration-150 ease-in-out shadow-md">Limpiar Filtros</button>
            </div>
        </section>

        <section id="listings" class="mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-sky-700">Listado de Vehículos</h2>
             <p class="mb-6 text-stone-600">Aquí se muestran los vehículos que coinciden con sus criterios de búsqueda. Explore las opciones disponibles.</p>
            <div id="listingsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
            <p id="noResultsMessage" class="text-center text-stone-500 py-8 text-xl hidden">No se encontraron vehículos que coincidan con los filtros seleccionados.</p>
        </section>

        <section id="charts" class="p-6 bg-white rounded-lg shadow-lg">
            <h2 class="text-2xl font-semibold mb-6 text-sky-700">Visualización de Datos</h2>
            <p class="mb-8 text-stone-600">Los siguientes gráficos ofrecen una perspectiva visual de los datos de los vehículos filtrados, ayudándole a identificar tendencias y distribuciones.</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-stone-50 p-4 rounded-lg shadow">
                    <h3 class="text-xl font-medium mb-3 text-sky-600 text-center">Distribución de Precios</h3>
                    <div class="chart-container h-72 md:h-80 max-w-xl">
                        <canvas id="priceDistributionChart"></canvas>
                    </div>
                    <p class="text-sm text-stone-500 mt-2 text-center">Este gráfico muestra cuántos vehículos se encuentran en diferentes rangos de precios.</p>
                </div>
                <div class="bg-stone-50 p-4 rounded-lg shadow">
                    <h3 class="text-xl font-medium mb-3 text-sky-600 text-center">Vehículos por Marca</h3>
                    <div class="chart-container h-72 md:h-80 max-w-md">
                        <canvas id="carsByBrandChart"></canvas>
                    </div>
                     <p class="text-sm text-stone-500 mt-2 text-center">Este gráfico ilustra la proporción de vehículos para cada marca disponible.</p>
                </div>
                <div class="bg-stone-50 p-4 rounded-lg shadow">
                    <h3 class="text-xl font-medium mb-3 text-sky-600 text-center">Vehículos por Año</h3>
                    <div class="chart-container h-72 md:h-80 max-w-xl">
                        <canvas id="carsByYearChart"></canvas>
                    </div>
                     <p class="text-sm text-stone-500 mt-2 text-center">Este gráfico presenta la cantidad de vehículos disponibles para cada año de modelo.</p>
                </div>
                <div class="bg-stone-50 p-4 rounded-lg shadow">
                    <h3 class="text-xl font-medium mb-3 text-sky-600 text-center">Vehículos por Ubicación</h3>
                    <div class="chart-container h-72 md:h-80 max-w-md">
                        <canvas id="carsByLocationChart"></canvas>
                    </div>
                    <p class="text-sm text-stone-500 mt-2 text-center">Este gráfico muestra la distribución geográfica de los vehículos listados.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center p-6 mt-10 text-stone-600 bg-stone-200">
        <p>&copy; <span id="currentYear"></span> Explorador de Vehículos. Todos los derechos reservados.</p>
    </footer>

    <script>
        const carData = [
            { brand: "Subaru", features: "WRX 2.4i Performance Awt Mt", year: 2025, currency: "USD", price: 84800, location: "Canelones, Ciudad de la Costa" },
            { brand: "Toyota", features: "Corolla Cross 1.8 Hybrid XEI CVT", year: 2024, currency: "USD", price: 38500, location: "Montevideo" },
            { brand: "Hyundai", features: "Creta 1.6 GL AT", year: 2024, currency: "USD", price: 29990, location: "Maldonado, Punta del Este" },
            { brand: "Volkswagen", features: "Nivus 1.0 TSI Highline AT", year: 2025, currency: "USD", price: 34500, location: "Colonia del Sacramento" },
            { brand: "Ford", features: "Ranger XLT 3.2L Diesel AT 4x4", year: 2024, currency: "USD", price: 58000, location: "Salto" },
            { brand: "Chevrolet", features: "Onix Plus 1.0 Turbo LTZ AT", year: 2025, currency: "USD", price: 23700, location: "Paysandú" },
            { brand: "Nissan", features: "Kicks 1.6 Exclusive CVT", year: 2024, currency: "USD", price: 31500, location: "Rocha, La Paloma" },
            { brand: "BMW", features: "320i SportLine Sedan", year: 2023, currency: "USD", price: 62000, location: "Montevideo" },
            { brand: "Mercedes-Benz", features: "C 200 Avantgarde Sedan", year: 2024, currency: "USD", price: 71000, location: "Canelones, Solymar" },
            { brand: "Suzuki", features: "Swift 1.2 GL MT", year: 2025, currency: "USD", price: 19990, location: "Montevideo" }
        ];

        const brandFilter = document.getElementById('brandFilter');
        const yearFilter = document.getElementById('yearFilter');
        const locationFilter = document.getElementById('locationFilter');
        const priceRangeFilter = document.getElementById('priceRangeFilter');
        const priceValue = document.getElementById('priceValue');
        const listingsContainer = document.getElementById('listingsContainer');
        const clearFiltersButton = document.getElementById('clearFiltersButton');
        const noResultsMessage = document.getElementById('noResultsMessage');
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        let priceDistributionChart, carsByBrandChart, carsByYearChart, carsByLocationChart;

        function populateFilters() {
            const brands = [...new Set(carData.map(car => car.brand))].sort();
            const years = [...new Set(carData.map(car => car.year))].sort((a, b) => b - a);
            const locations = [...new Set(carData.map(car => car.location))].sort();
            
            const maxPrice = Math.max(...carData.map(car => car.price));
            const minPrice = Math.min(...carData.map(car => car.price));
            priceRangeFilter.max = maxPrice;
            priceRangeFilter.min = minPrice;
            priceRangeFilter.value = maxPrice; // Default to max price
            priceValue.textContent = `$${maxPrice.toLocaleString()}`;

            brands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                brandFilter.appendChild(option);
            });

            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });

            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                locationFilter.appendChild(option);
            });
        }

        function displayListings(filteredData) {
            listingsContainer.innerHTML = '';
            if (filteredData.length === 0) {
                noResultsMessage.classList.remove('hidden');
            } else {
                noResultsMessage.classList.add('hidden');
                filteredData.forEach(car => {
                    const carCard = document.createElement('div');
                    carCard.className = 'listing-card';
                    carCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-sky-700 mb-2">${car.brand} ${car.features}</h3>
                        <p class="text-stone-700 mb-1"><span class="font-medium">Año:</span> ${car.year}</p>
                        <p class="text-stone-700 mb-1"><span class="font-medium">Ubicación:</span> ${car.location}</p>
                        <p class="text-lg font-bold text-green-600 mt-2">${car.currency} ${car.price.toLocaleString()}</p>
                    `;
                    listingsContainer.appendChild(carCard);
                });
            }
        }
        
        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            let lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = ctx.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        function updateCharts(filteredData) {
            const brandCounts = {};
            const yearCounts = {};
            const locationCounts = {};
            const prices = filteredData.map(car => car.price);

            filteredData.forEach(car => {
                brandCounts[car.brand] = (brandCounts[car.brand] || 0) + 1;
                yearCounts[car.year] = (yearCounts[car.year] || 0) + 1;
                locationCounts[car.location] = (locationCounts[car.location] || 0) + 1;
            });

            const sortedYears = Object.keys(yearCounts).sort((a,b) => a - b);
            const sortedYearData = sortedYears.map(year => yearCounts[year]);

            const priceRanges = [0, 20000, 40000, 60000, 80000, 100000, Infinity];
            const priceRangeLabels = ["<$20k", "$20k-$40k", "$40k-$60k", "$60k-$80k", "$80k-$100k", ">$100k"];
            const priceDistribution = Array(priceRangeLabels.length).fill(0);
            prices.forEach(price => {
                for (let i = 0; i < priceRanges.length - 1; i++) {
                    if (price >= priceRanges[i] && price < priceRanges[i+1]) {
                        priceDistribution[i]++;
                        break;
                    }
                }
            });

            const chartColors = [
                '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', 
                '#06b6d4', '#ec4899', '#6366f1', '#d946ef', '#f97316'
            ]; // Tailwind colors

            if (priceDistributionChart) priceDistributionChart.destroy();
            priceDistributionChart = new Chart(document.getElementById('priceDistributionChart'), {
                type: 'bar',
                data: {
                    labels: priceRangeLabels,
                    datasets: [{
                        label: 'Número de Vehículos',
                        data: priceDistribution,
                        backgroundColor: chartColors[0],
                        borderColor: chartColors[0],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
                    plugins: { legend: { display: false } }
                }
            });

            if (carsByBrandChart) carsByBrandChart.destroy();
            carsByBrandChart = new Chart(document.getElementById('carsByBrandChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(brandCounts),
                    datasets: [{
                        label: 'Vehículos por Marca',
                        data: Object.values(brandCounts),
                        backgroundColor: chartColors,
                        hoverOffset: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top'} } }
            });
            
            if (carsByYearChart) carsByYearChart.destroy();
            carsByYearChart = new Chart(document.getElementById('carsByYearChart'), {
                type: 'bar',
                data: {
                    labels: sortedYears,
                    datasets: [{
                        label: 'Número de Vehículos',
                        data: sortedYearData,
                        backgroundColor: chartColors[1],
                        borderColor: chartColors[1],
                        borderWidth: 1
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
                    plugins: { legend: { display: false } }
                }
            });

            if (carsByLocationChart) carsByLocationChart.destroy();
            carsByLocationChart = new Chart(document.getElementById('carsByLocationChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(locationCounts),
                    datasets: [{
                        label: 'Vehículos por Ubicación',
                        data: Object.values(locationCounts),
                        backgroundColor: chartColors,
                        hoverOffset: 4
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            position: 'top',
                            labels: {
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map(function(label, i) {
                                            const meta = chart.getDatasetMeta(0);
                                            const style = meta.controller.getStyle(i);
                                            const text = label.length > 16 ? label.substring(0,16) + '...' : label; // Truncate long labels
                                            return {
                                                text: text,
                                                fillStyle: style.backgroundColor,
                                                strokeStyle: style.borderColor,
                                                lineWidth: style.borderWidth,
                                                hidden: isNaN(data.datasets[0].data[i]) || meta.data[i].hidden,
                                                index: i
                                            };
                                        });
                                    }
                                    return [];
                                }
                            }
                        } 
                    } 
                }
            });
        }

        function filterData() {
            const selectedBrand = brandFilter.value;
            const selectedYear = yearFilter.value;
            const selectedLocation = locationFilter.value;
            const selectedMaxPrice = parseInt(priceRangeFilter.value);

            const filtered = carData.filter(car => {
                return (selectedBrand === '' || car.brand === selectedBrand) &&
                       (selectedYear === '' || car.year === parseInt(selectedYear)) &&
                       (selectedLocation === '' || car.location === selectedLocation) &&
                       (car.price <= selectedMaxPrice);
            });

            displayListings(filtered);
            updateCharts(filtered);
        }
        
        function resetFilters() {
            brandFilter.value = '';
            yearFilter.value = '';
            locationFilter.value = '';
            priceRangeFilter.value = priceRangeFilter.max;
            priceValue.textContent = `$${parseInt(priceRangeFilter.max).toLocaleString()}`;
            filterData();
        }

        brandFilter.addEventListener('change', filterData);
        yearFilter.addEventListener('change', filterData);
        locationFilter.addEventListener('change', filterData);
        priceRangeFilter.addEventListener('input', () => {
            priceValue.textContent = `$${parseInt(priceRangeFilter.value).toLocaleString()}`;
        });
        priceRangeFilter.addEventListener('change', filterData); // Filter on release for performance
        clearFiltersButton.addEventListener('click', resetFilters);

        populateFilters();
        filterData(); // Initial display
    </script>
</body>
</html>
